$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});Chart.defaults.global.legend.display=false;Chart.defaults.global.defaultFontFamily="'Montserrat', 'Arial', 'sans-serif'";var DATE_FORMAT="YYYY-MM-DD";var DATE_MAX="3000-01-01";var DATE_MIN="1970-01-01";var statsURI="/stats/";var graphId="graph";var ctx=document.getElementById(graphId).getContext("2d");var view;var lang={};var chart;var no_selectpicker=false;$(document).ready(function(){if(!no_selectpicker){selectpickerChanged();$(".selectpicker").on("change",selectpickerChanged)}});function selectpickerChanged(){var c=$(".selectpicker").selectpicker("val").split("-");var a=c[0];if(c.length===2){var b=c[1]}switch(a){case"limit":updateChart({limit:b,selector:a});break;case"last":updateChart({from:moment().subtract(b,"days").format(DATE_FORMAT),to:moment().format(DATE_FORMAT),days:b,selector:a});break;case"all":updateChart({from:DATE_MIN,to:DATE_MAX,selector:a});break}}function updateChart(a){$.post(statsURI+view,a,function(c,b){if(b=="success"){c=prepareData(a,c);if(chart==null){chart=new Chart(ctx,{type:"line",data:{labels:c.labels,datasets:c.datasets},options:{scales:{yAxes:[{ticks:{beginAtZero:true}}]}}})}else{chart.data.labels=c.labels;chart.data.datasets=c.datasets;chart.update()}}else{console.error("Failed to load data. Status: "+b)}})}function prepareData(j,a){var e=extractLabels(j,a);var c={labels:e,datasets:[]};var l=[];if(is_set(a.keys)){for(var d=0;d<a.keys.length;d++){l.push(a.keys[d]);c.datasets.push(initDataset(a.keys[d]))}}else{l.push("value");c.datasets.push(initDataset("value"))}if(a.data.length==0){return c}var g=0;var f=false;for(var d=0;d<e.length;d++){for(var b=0;b<l.length;b++){var h=l[b];if(g<a.data.length&&e[d]==a.data[g].date){c.datasets[b].data.push(a.data[g][h]);f=true}else{c.datasets[b].data.push(0)}}if(f){g++;f=false}}return c}function extractLabels(c,f){var e=[];switch(c.selector){case"limit":for(var b=0;b<f.data.length;b++){e.push(f.data[b].date)}break;case"last":var d=moment(c.from);var a=moment(c.to);while(d.format(DATE_FORMAT)!==a.format(DATE_FORMAT)){e.push(d.add(1,"days").format(DATE_FORMAT))}break;case"all":if(f.data.length===0){return[]}if(is_set(f.limit)){for(var b=0;b<f.data.length;b++){e.push(f.data[b].date)}}else{var d=moment(f.data[0].date);var a=moment();e.push(d.format(DATE_FORMAT));while(d.format(DATE_FORMAT)!==a.format(DATE_FORMAT)){e.push(d.add(1,"days").format(DATE_FORMAT))}}break}return e}function initDataset(a){var b={label:a=="value"?lang[view]:lang[a],data:[],lineTension:0.3,backgroundColor:"rgba(0, 200, 83, 0.3)",borderColor:"rgba(0, 200, 83, 1)",borderWidth:1};switch(view){case"velocity":b.backgroundColor="rgba(3, 169, 244, 0.3)";b.borderColor="rgba(3, 169, 244, 1)";break;case"xp":b.backgroundColor="rgba(244, 67, 54, 0.3)";b.borderColor="rgba(244, 67, 54, 1)";break;case"keystrokes":if(a==="errors"){b.backgroundColor="rgba(244, 67, 54, 0.3)";b.borderColor="rgba(244, 67, 54, 1)"}break}return b}function is_set(a){return(typeof a!=="undefined")};